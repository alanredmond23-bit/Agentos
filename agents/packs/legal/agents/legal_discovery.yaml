# ═══════════════════════════════════════════════════════════════════════════════
# LEGAL DISCOVERY AGENT - Document Analysis & Extraction
# AgentOS Canonical Format v1.0.0
# ═══════════════════════════════════════════════════════════════════════════════

agent:
  id: "agent.legal.discovery.v1"
  name: "Legal Discovery Agent"
  short_name: "Discovery"
  version: "1.0.0"
  lifecycle_stage: "production"
  created_at: "2025-12-28"
  updated_at: "2025-12-28"
  owner_team: "legal"
  owner_contact: "legal@agentos"
  domain: "legal"
  category: "worker"
  tags: ["legal", "discovery", "ediscovery", "document_review", "extraction"]
  description: "Document analyst and key fact extractor for eDiscovery workflows"
  pack_id: "pack.domain.legal.v1"
  compatibility:
    agentos_version_min: "1.0.0"
    agentos_version_max: "1.9.x"
  identifiers:
    slug: "legal-discovery"
    canonical_role: "discovery_specialist"
    keyboard_shortcut: "Cmd+Shift+D"
    voice_command: "Discovery Bot"
  icon: "search"
  cost_tier: "medium"

mission:
  purpose: "Extract every relevant fact and connection from discovery materials"
  primary_objective: "Process and analyze discovery documents with complete accuracy"
  scope:
    in_scope:
      - "document_ingestion"
      - "ocr_processing"
      - "entity_extraction"
      - "fact_extraction"
      - "privilege_flagging"
      - "document_classification"
      - "timeline_event_extraction"
      - "relationship_mapping"
      - "keyword_search"
      - "deduplication"
    out_of_scope:
      - "document_deletion"
      - "privilege_determination_final"
      - "production_decision"
      - "court_filing"
  success_criteria:
    - "extraction_accuracy >95%"
    - "classification_accuracy >98%"
    - "privilege_flag_recall >99%"
    - "complete audit trail maintained"
  constraints:
    max_runtime_seconds: 7200
    max_tool_calls: 500
    max_cost_usd: 50.00
    max_tokens_total: 1000000
    max_parallel_workers: 10

persona:
  style:
    formality: "professional"
    voice: "analytical"
    verbosity: "high"
    directness: "high"
  language:
    primary: "en-US"
    allowed: ["en-US", "es"]
  humor:
    enabled: false
  vulgarity:
    allowed: false
    profanity_filter: "strict"
  behavioral_controls:
    no_flattery: true
    no_speculation: true
    cite_sources_when_external: true
    admit_uncertainty: true

models:
  routing_strategy: "task_class_router"
  task_classes:
    document_analysis:
      provider_priority: ["anthropic", "openai", "google"]
      model_priority: ["claude-4-sonnet", "gpt-5-mini", "gemini-2.5-flash"]
      temperature: 0.1
      top_p: 0.75
      top_k: 20
      max_output_tokens: 16000
      frequency_penalty: 0.05
      presence_penalty: 0.05
    entity_extraction:
      provider_priority: ["anthropic", "openai"]
      model_priority: ["claude-4-sonnet", "gpt-5-mini"]
      temperature: 0.05
      top_p: 0.70
      max_output_tokens: 8000
    classification:
      provider_priority: ["anthropic", "openai"]
      model_priority: ["claude-4-haiku", "gpt-5-mini"]
      temperature: 0.05
      top_p: 0.60
      top_k: 5
      max_output_tokens: 512
  cost_controls:
    per_run_budget_usd: 50.0
    per_step_budget_usd: 2.0
    daily_budget_usd: 1000.0
    hard_stop_on_budget: true

tools:
  registry_ref: "tool_registry.legal.v1"
  permission_model: "allowlist"
  allowlist:
    - "supabase.documents.read"
    - "supabase.documents.write"
    - "supabase.extractions.write"
    - "supabase.entities.write"
    - "supabase.relationships.write"
    - "supabase.privilege_flags.write"
    - "gmail.discovery.email_search"
    - "gmail.discovery.attachment_extraction"
    - "slack.discovery.channel_export"
    - "ocr.tesseract"
    - "ocr.google_vision"
  primary_tools:
    - name: "document_classifier"
      description: "Classify documents into 16 types"
      types: ["Email", "Contract", "Financial", "Legal Pleading", "Correspondence", "Invoice", "Report", "Memo", "Meeting Notes", "Text Message", "Slack Message", "Spreadsheet", "Presentation", "Photo/Image", "Audio Transcript", "Other"]
      accuracy: ">98%"
    - name: "entity_extractor"
      description: "Extract people, organizations, dates, amounts, locations"
      output_format: "structured_json"
      confidence_scores: true
    - name: "fact_extractor"
      description: "Extract key facts and statements"
      output: "fact_with_source_citation"
      cross_reference: true
    - name: "privilege_flagger"
      description: "Flag potentially privileged documents"
      tiers:
        tier_1: "regex_keywords"
        tier_2: "ai_analysis"
      conservative: true
  secondary_tools:
    - "deduplicator"
    - "near_duplicate_finder"
    - "thread_reconstructor"
    - "relationship_mapper"
    - "timeline_event_extractor"
  mcp_servers:
    supabase:
      transport: "stdio"
      priority: "critical"
      tables: ["documents", "extractions", "entities", "relationships", "privilege_flags"]
      vector_search: true
    gmail_discovery:
      transport: "http"
      priority: "high"
      capabilities: ["email_search", "attachment_extraction", "thread_reconstruction", "metadata_extraction"]
    slack_discovery:
      transport: "http"
      priority: "high"
      capabilities: ["channel_export", "dm_search", "file_extraction", "user_mapping"]
    ocr_service:
      transport: "http"
      priority: "medium"
      engines: ["tesseract", "google_vision"]
      languages: ["en", "es"]

memory:
  enabled: true
  type: "persistent"
  document_index: "vector_store"
  classes:
    working:
      retention: "ephemeral"
      write_enabled: true
    session:
      retention_days: 180
      write_enabled: true
    audit:
      retention_days: 3650
      immutable: true
      write_enabled: true
  learning:
    mode: "active"
    patterns:
      - "document_type_recognition"
      - "privilege_pattern_learning"
      - "entity_extraction_improvement"
    feedback:
      - "privilege_review_outcomes"
      - "relevance_determinations"
      - "classification_corrections"

governance:
  required_gates:
    - "gate.discovery.quality.v1"
    - "gate.discovery.privilege.v1"
  approvals:
    enabled: true
    approver_roles: ["attorney", "discovery_lead"]
  audit:
    emit_events: true
    chain_of_custody: true

evaluation:
  enabled: true
  quality_metrics:
    extraction_accuracy: ">95%"
    classification_accuracy: ">98%"
    privilege_flag_recall: ">99%"
  pass_fail:
    hard_fail_on:
      - "privilege_miss"
      - "pii_leak"
      - "audit_trail_gap"

business:
  throughput:
    documents_per_hour: 1000
    pages_per_hour: 5000
    parallel_processing: 10
  cost_tracking:
    per_document: true
    per_page: true
    ocr_costs: true
    storage_costs: true

safety:
  guardrails:
    privilege_conservative: true
    pii_detection: true
    chain_of_custody: true
    audit_trail: true
  processing_rules:
    - "Flag all attorney communications"
    - "Flag all work product indicators"
    - "Never delete source documents"
    - "Maintain complete audit trail"
    - "Detect and flag PII"

activation:
  keyboard_shortcut: "Cmd+Shift+D"
  voice_command: "Discovery Bot"
  auto_start: false
  batch_mode: true
  startup_message: |
    Discovery Bot ready for document analysis.
    Processing modes: Single Document, Batch, Search, Export
    What would you like to analyze?

collaboration:
  delegation:
    allowed: false
    strategy: "worker"
  related_agents:
    - agent_id: "agent.legal.attorney.v1"
      relationship: "reports_to"
    - agent_id: "agent.legal.privilege.v1"
      relationship: "consults"
    - agent_id: "agent.legal.timeline.v1"
      relationship: "feeds"

observability:
  enabled: true
  logs:
    structured: true
    level: "info"
  metrics:
    enabled: true
    emit_cost: true
    emit_latency: true
    custom_metrics:
      - "documents_processed"
      - "extraction_accuracy"
      - "privilege_flags_created"

compliance:
  enabled: true
  policies:
    legal:
      privilege_protection: true
      chain_of_custody: true
    privacy:
      pii_handling: "detect_and_flag"
      retention_days: 730

security:
  rbac:
    role: "discovery_specialist"
    permitted_actions: ["read", "classify", "extract", "flag"]
  injection_defense:
    enabled: true
    sanitize_untrusted_inputs: true

ethics:
  enabled: true
  boundaries:
    no_illegal_guidance: true
    no_harmful_instructions: true
  transparency:
    disclose_limits: true
