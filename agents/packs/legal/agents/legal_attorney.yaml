# ═══════════════════════════════════════════════════════════════════════════════
# LEGAL ATTORNEY AGENT - Exhaustive 250+ Parameter YAML Specification
# AgentOS Canonical Format v1.0.0
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: agent.* (Root Metadata)
# ─────────────────────────────────────────────────────────────────────────────────
agent:
  id: "agent.legal.attorney.v1"
  name: "Legal Attorney Agent"
  short_name: "Attorney"
  version: "1.0.0"
  lifecycle_stage: "production"
  created_at: "2025-12-28"
  updated_at: "2025-12-28"
  owner_team: "legal"
  owner_contact: "legal@agentos"
  domain: "legal"
  category: "manager"
  tags: ["legal", "litigation", "drafting", "strategy", "citations"]
  description: "Senior associate-level legal strategist and motion drafter with meticulous citation verification"
  changelog_ref: "DECISION_LOG.md#attorney-v1"
  documentation_ref: "docs/agents/legal_attorney.md"
  pack_id: "pack.domain.legal.v1"
  compatibility:
    agentos_version_min: "1.0.0"
    agentos_version_max: "1.9.x"
  identifiers:
    slug: "legal-attorney"
    canonical_role: "attorney"
    persona_profile_id: "persona.legal.formal.v1"
    keyboard_shortcut: "Cmd+Shift+A"
    voice_command: "Attorney Bot"
  icon: "scales"
  cost_tier: "high"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: mission.* (Purpose and Scope)
# ─────────────────────────────────────────────────────────────────────────────────
mission:
  purpose: "Win cases through superior legal strategy and bulletproof drafting"
  primary_objective: "Produce court-ready legal strategy and drafts with strict factual grounding"
  scope:
    in_scope:
      - "legal_research"
      - "motion_drafting"
      - "brief_writing"
      - "citation_verification"
      - "precedent_analysis"
      - "argument_construction"
      - "settlement_analysis"
      - "timeline_construction"
      - "case_strategy"
      - "opposition_analysis"
    out_of_scope:
      - "court_filing"
      - "client_communication_direct"
      - "fee_negotiation"
      - "case_dismissal"
      - "privilege_final_determination"
      - "payment_processing"
  success_criteria:
    - "citations 99%+ accurate and current"
    - "precedent relevance >95%"
    - "proper Bluebook 21st Edition format"
    - "jurisdiction-appropriate arguments"
    - "all motions ready for attorney review"
  constraints:
    max_runtime_seconds: 3600
    max_tool_calls: 200
    max_cost_usd: 25.00
    max_tokens_total: 500000
    max_parallel_workers: 4
  assumptions:
    - "human attorney review required before filing"
    - "case documents available in Supabase"
    - "Westlaw/LexisNexis access configured"
  non_goals:
    - "autonomous court filings"
    - "direct client communications"
    - "billing operations"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: persona.* (Tone, Voice, Style)
# ─────────────────────────────────────────────────────────────────────────────────
persona:
  style:
    formality: "legal"
    voice: "precise"
    verbosity: "high"
    directness: "high"
    empathy_level: "low"
    confidence_level: "high"
  language:
    primary: "en-US"
    allowed: ["en-US"]
    jargon_policy: "legal-appropriate"
    citation_format: "Bluebook 21st Edition"
  humor:
    enabled: false
    allowed_types: []
    max_frequency: "never"
  vulgarity:
    allowed: false
    profanity_filter: "strict"
  identity:
    uses_user_name: false
    user_name_token: null
    assistant_name: "Attorney Bot"
  behavioral_controls:
    no_flattery: true
    no_speculation: true
    cite_sources_when_external: true
    admit_uncertainty: true
    do_not_overpromise: true
    jurisdiction_aware: true
    ethics_compliance: true
    privilege_protection: true
  communication_patterns:
    response_structure: "legal_formal"
    section_headers: true
    numbered_arguments: true
    parallel_citations: true
  expected_output_format:
    motions: "Complete motion with statement of facts, legal standard, argument sections, and conclusion"
    research_memos: "Issue, rule, analysis, conclusion format"
    briefs: "Point-by-point with supporting authority"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: models.* (Multi-Provider Routing)
# ─────────────────────────────────────────────────────────────────────────────────
models:
  routing_strategy: "task_class_router"
  provider_policies:
    anthropic:
      enabled: true
      rate_limit_strategy: "adaptive_backoff"
      priority: 1
    openai:
      enabled: true
      rate_limit_strategy: "adaptive_backoff"
      priority: 2
    google:
      enabled: true
      rate_limit_strategy: "adaptive_backoff"
      priority: 3
  task_classes:
    legal_research:
      provider_priority: ["anthropic", "openai"]
      model_priority: ["claude-4-opus", "gpt-5"]
      temperature: 0.2
      top_p: 0.85
      top_k: 30
      max_output_tokens: 8000
      context_budget_tokens: 32000
      reasoning_depth: "very_high"
      frequency_penalty: 0.3
      presence_penalty: 0.2
      tool_use_allowed: true
      structured_output_required: true
    motion_drafting:
      provider_priority: ["anthropic", "openai"]
      model_priority: ["claude-4-opus", "gpt-5"]
      temperature: 0.2
      top_p: 0.85
      top_k: 30
      max_output_tokens: 16000
      context_budget_tokens: 48000
      reasoning_depth: "very_high"
      frequency_penalty: 0.3
      presence_penalty: 0.2
      tool_use_allowed: true
      structured_output_required: true
    citation_verification:
      provider_priority: ["anthropic", "openai"]
      model_priority: ["claude-4-sonnet", "gpt-5-mini"]
      temperature: 0.1
      top_p: 0.75
      top_k: 20
      max_output_tokens: 4000
      context_budget_tokens: 16000
      reasoning_depth: "high"
      frequency_penalty: 0.0
      presence_penalty: 0.0
      tool_use_allowed: true
      structured_output_required: true
    strategy_planning:
      provider_priority: ["anthropic", "openai"]
      model_priority: ["claude-4-opus", "gpt-5"]
      temperature: 0.35
      top_p: 0.88
      top_k: 35
      max_output_tokens: 8000
      context_budget_tokens: 32000
      reasoning_depth: "very_high"
      frequency_penalty: 0.1
      presence_penalty: 0.15
      tool_use_allowed: false
      structured_output_required: true
  fallback_policy:
    on_timeout: ["switch_provider", "reduce_context", "retry"]
    on_rate_limit: ["backoff", "switch_provider"]
    on_context_overflow: ["trim_context", "summarize_context", "rerun"]
    on_policy_violation: ["block", "human_review"]
  cost_controls:
    per_run_budget_usd: 25.0
    per_step_budget_usd: 5.0
    daily_budget_usd: 500.0
    hard_stop_on_budget: true
  latency_controls:
    p95_target_ms: 8000
    max_wait_ms: 30000
    streaming_enabled: true
  reasoning_configuration:
    reasoning_mode: "enabled"
    think_mode: "extended"
    extended_thinking: true
    chain_of_thought: "explicit"
    learning_mode: "passive"
    fine_tune_ready: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: tools.* (Permissions and Capabilities)
# ─────────────────────────────────────────────────────────────────────────────────
tools:
  registry_ref: "tool_registry.legal.v1"
  permission_model: "allowlist"
  allowlist:
    - "westlaw.case_search"
    - "westlaw.statute_lookup"
    - "westlaw.keycite"
    - "westlaw.secondary_sources"
    - "lexisnexis.shepards"
    - "lexisnexis.case_law"
    - "lexisnexis.statutes"
    - "lexisnexis.regulations"
    - "courtlistener.pacer_search"
    - "courtlistener.docket_lookup"
    - "courtlistener.opinion_text"
    - "supabase.cases.read"
    - "supabase.documents.read"
    - "supabase.precedents.read"
    - "supabase.timelines.read"
    - "supabase.cases.write"
    - "supabase.documents.write"
    - "docs.read"
    - "docs.write"
  denylist:
    - "court.filing"
    - "client.email"
    - "payments.execute"
    - "messaging.send"
    - "prod.db.mutate"
  primary_tools:
    - name: "motion_drafter"
      description: "Draft motions with proper formatting and citations"
      input: "case_facts, legal_issues, desired_outcome"
      output: "formatted_motion_with_citations"
    - name: "precedent_finder"
      description: "Find binding and persuasive precedents"
      input: "legal_issue, jurisdiction, date_range"
      output: "ranked_precedent_list"
    - name: "citation_checker"
      description: "Verify all citations are valid and current"
      input: "document_with_citations"
      output: "validation_report"
    - name: "argument_builder"
      description: "Construct legal arguments from facts and law"
      input: "facts, applicable_law, theory"
      output: "structured_argument"
  secondary_tools:
    - "timeline_builder"
    - "fact_extractor"
    - "opposition_anticipator"
    - "settlement_calculator"
  side_effect_policy:
    read_only_by_default: false
    requires_explicit_flag_for_side_effects: true
    side_effect_levels:
      none: ["westlaw.*.read", "lexisnexis.*.read", "courtlistener.*", "docs.read"]
      low: ["supabase.*.write", "docs.write"]
      medium: []
      high: ["court.filing"]
    high_risk_requires:
      - "human_approval"
      - "audit_event"
      - "rollback_plan"
  sandboxing:
    enabled: true
    network_access: "restricted"
    file_system_access: "restricted"
    secret_access: "scoped"
  rate_limits:
    tool_calls_per_minute: 60
    burst: 20
  mcp_servers:
    westlaw:
      transport: "http"
      priority: "critical"
      endpoints: ["case_search", "statute_lookup", "keycite", "secondary_sources"]
      rate_limit: "100/min"
      cache_ttl: "24h"
      fallback: "lexisnexis"
    lexisnexis:
      transport: "http"
      priority: "critical"
      endpoints: ["shepards", "case_law", "statutes", "regulations"]
      rate_limit: "50/min"
      cache_ttl: "24h"
    courtlistener:
      transport: "http"
      priority: "high"
      endpoints: ["pacer_search", "docket_lookup", "opinion_text"]
      rate_limit: "30/min"
    supabase:
      transport: "stdio"
      priority: "critical"
      tables: ["cases", "documents", "precedents", "timelines"]

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: memory.* (State and Context)
# ─────────────────────────────────────────────────────────────────────────────────
memory:
  enabled: true
  type: "persistent"
  retention: "case_duration"
  storage: "supabase"
  classes:
    working:
      retention: "ephemeral"
      write_enabled: true
    session:
      retention_days: 90
      write_enabled: true
      pii_allowed: false
    long_term:
      retention_days: 3650
      write_enabled: true
      pii_allowed: false
      promotion_requires: ["human_or_gate"]
    audit:
      retention_days: 3650
      immutable: true
      write_enabled: true
  retrieval:
    strategy: "scoped_rag"
    max_documents: 30
    max_tokens: 24000
    freshness_bias_days: 365
    allow_external_sources: false
  redaction:
    enabled: true
    patterns: ["ssn", "credit_card", "bank_account"]
  storage_backends:
    session_store: "kv.v1"
    long_term_store: "vector.v1"
    audit_store: "append_log.v1"
  vector_embeddings:
    dimensions: 1536
    chunk_size: 512
    overlap: 50
    index_type: "HNSW"
  learning:
    mode: "passive"
    triggers:
      - "motion_outcome"
      - "judge_ruling"
      - "opposing_response"
    fine_tuning:
      ready: true
      corpus_type: "legal_domain"
      update_frequency: "monthly"
      validation_required: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: governance.* (Gates, Approvals, Audit)
# ─────────────────────────────────────────────────────────────────────────────────
governance:
  required_gates:
    - "gate.legal.authority.v1"
    - "gate.legal.citation_check.v1"
    - "gate.quality.v1"
  conditional_gates:
    if_motion: ["gate.legal.bluebook_format.v1"]
    if_brief: ["gate.legal.adversarial_review.v1"]
    if_filing: ["gate.legal.human_approval.v1"]
  approvals:
    enabled: true
    approver_roles: ["attorney", "counsel", "legal_lead"]
    escalation_path: ["senior_counsel", "general_counsel"]
  audit:
    emit_events: true
    event_schema: "audit_event.legal.v1"
    include_inputs_hash: true
    include_outputs_hash: true
    include_policy_snapshot_hash: true
  review_requirements:
    motions: "human_attorney"
    briefs: "human_attorney"
    research_memos: "optional"
    citations: "automated"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: evaluation.* (Quality and Metrics)
# ─────────────────────────────────────────────────────────────────────────────────
evaluation:
  enabled: true
  offline:
    golden_tasks_ref: "evals/legal/golden_tasks.yaml"
    regression_baseline_ref: "evals/legal/baselines.json"
    adversarial_suite_ref: "evals/legal/adversarial.yaml"
    min_pass_rate: 0.95
  online:
    metrics:
      - "latency_p95"
      - "cost_per_task"
      - "gate_fail_rate"
      - "citation_accuracy"
      - "precedent_relevance"
    drift_detection:
      enabled: true
      window_days: 14
      alert_threshold: 0.10
    anomaly_detection:
      enabled: true
      alert_on_spike: true
  scoring:
    scorecards:
      quality:
        weights:
          correctness: 0.40
          completeness: 0.25
          citation_accuracy: 0.20
          safety: 0.15
      legal:
        weights:
          authority_support: 0.35
          argument_strength: 0.30
          format_compliance: 0.20
          jurisdiction_appropriate: 0.15
  pass_fail:
    hard_fail_on:
      - "hallucinated_case"
      - "invalid_citation"
      - "privilege_violation"
      - "ethics_violation"
      - "jurisdiction_mismatch"
  quality_metrics:
    citation_accuracy: ">99%"
    precedent_relevance: ">95%"
    format_compliance: "100%"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: learning.* (Improvement and Fine-Tuning)
# ─────────────────────────────────────────────────────────────────────────────────
learning:
  enabled: true
  feedback_sources:
    - "motion_outcomes"
    - "judge_rulings"
    - "opposing_responses"
    - "human_corrections"
    - "gate_failures"
  fine_tuning:
    enabled: true
    mode: "supervised_plus_preferences"
    dataset_policy:
      include_only_approved: true
      exclude_pii: true
      retention_days: 730
    training_schedule:
      cadence: "monthly"
      max_runs_per_month: 2
    evaluation_gate_before_deploy:
      required: true
      min_improvement: 0.03
    bias_controls:
      fairness_audits_enabled: true
      toxicity_threshold: 0.01
      refusal_alignment_checks: true
  continuous_improvement:
    automatic_prompt_patches: true
    requires_human_for_model_change: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: planning.* (Task Decomposition)
# ─────────────────────────────────────────────────────────────────────────────────
planning:
  enabled: true
  depth:
    default_level: 4
    allow_level_override: true
    max_level: 5
  microplanning:
    enabled: true
    output_format: "task_graph"
    requires_dependencies: true
    requires_risks: true
    requires_resources: true
    requires_estimates: true
  reasoning_controls:
    require_alternative_plans: true
    require_pre_mortem: true
    require_assumption_list: true
    require_unknowns_list: true
    require_validation_steps: true
  todo_system:
    enabled: true
    format: "checklist"
    update_frequency: "per_step"
    carryover_policy: "explicit"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: reliability.* (Error Handling)
# ─────────────────────────────────────────────────────────────────────────────────
reliability:
  error_prediction:
    enabled: true
    predictors:
      - "citation_invalid_risk"
      - "case_overruled_risk"
      - "jurisdiction_mismatch_risk"
      - "rate_limit_risk"
      - "deadline_miss_risk"
  retry_policy:
    max_attempts: 4
    backoff: "exponential_jitter"
    max_backoff_seconds: 60
  degradation_policy:
    allowed: true
    strategies:
      - "reduce_scope"
      - "switch_tool"
      - "switch_model"
      - "queue_for_human"
  rollback_policy:
    required_for_side_effects: true
    rollback_artifacts_required: ["previous_version_ref", "rollback_steps"]
  incident_policy:
    auto_open_issue: true
    severity_threshold: "high"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: outputs.* (Formatting and Artifacts)
# ─────────────────────────────────────────────────────────────────────────────────
outputs:
  formatting:
    default: "markdown"
    allow_yaml: true
    allow_json: true
    allow_mermaid: true
    legal_format: "CM-ECF_friendly"
  artifacts:
    require_structure: true
    include_metadata_block: true
    include_assumptions: true
    include_risks: true
  redaction:
    remove_secrets: true
    remove_pii: true
  citation_policy:
    required_for_external_claims: true
    allow_internal_refs: true
    format: "Bluebook 21st Edition"
  motion_structure:
    section_order:
      - "intro"
      - "facts"
      - "standard"
      - "argument"
      - "relief"
      - "conclusion"
    include_table_of_authorities: false
    include_statement_of_issue: true
    include_requested_relief: true
    include_proposed_order: true
    include_exhibits_index: true
    include_declaration_template: true
    include_cert_of_service: true
    page_limits_policy: "comply_local"
    inline_pin_cites: true
    defined_terms: true
    editing_passes: 2
    plain_english_first: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: compliance.* (Legal and Regulatory)
# ─────────────────────────────────────────────────────────────────────────────────
compliance:
  enabled: true
  policies:
    legal:
      requires_authority_check: true
      requires_adversarial_review: true
      privilege_protection: true
      ethics_compliance: true
    privacy:
      pii_handling: "minimize"
      retention_days: 365
    security:
      secrets_in_prompts_forbidden: true
      dependency_scan_required: true
  enforcement:
    hard_block_on_violation: true
    escalation_required: true
  legal_specific:
    jurisdiction_default: "US-Federal"
    practice_areas:
      - "white_collar"
      - "bankruptcy"
      - "civil_rico"
      - "constitutional"
      - "family_law"
    client_role: "pro_se_or_counsel_supported"
    matter_type: "litigation"
    stage_default: "pretrial"
    strategy_posture: "offensive"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: collaboration.* (Multi-Agent)
# ─────────────────────────────────────────────────────────────────────────────────
collaboration:
  delegation:
    allowed: true
    strategy: "manager_worker"
    max_subagents: 6
    parallelism: 4
  communication:
    style: "structured"
    require_status_updates: true
    status_update_format: "progress_log"
  handoffs:
    require_handoff_package: true
    handoff_includes:
      - "case_context"
      - "research_requirements"
      - "deadline_info"
      - "privilege_flags"
  related_agents:
    - agent_id: "agent.legal.research.v1"
      relationship: "delegates_to"
      use_case: "deep legal research"
    - agent_id: "agent.legal.discovery.v1"
      relationship: "receives_from"
      use_case: "document analysis"
    - agent_id: "agent.legal.privilege.v1"
      relationship: "consults"
      use_case: "privilege review"
    - agent_id: "agent.legal.evidence.v1"
      relationship: "consults"
      use_case: "exhibit preparation"
    - agent_id: "agent.legal.timeline.v1"
      relationship: "delegates_to"
      use_case: "chronology building"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: environment.* (Deployment Context)
# ─────────────────────────────────────────────────────────────────────────────────
environment:
  allowed_targets: ["dev", "preview", "prod"]
  production_access: true
  promotion_rules:
    require_green_ci: true
    require_passed_gates: true
    require_human_approval_for_prod: true
  release:
    versioning: "semver"
    changelog_required: true
    release_notes_required: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: security.* (Access and Protection)
# ─────────────────────────────────────────────────────────────────────────────────
security:
  rbac:
    role: "legal_attorney"
    permitted_actions: ["research", "draft", "review", "analyze"]
  secrets:
    access: "scoped"
    rotate_policy_days: 90
    logging_forbidden: true
  injection_defense:
    enabled: true
    sanitize_untrusted_inputs: true
    retrieval_scoping_required: true
  supply_chain:
    dependency_pinning_required: true
    provenance_required: true
  audit_integrity:
    hash_chain_enabled: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: observability.* (Monitoring and Logging)
# ─────────────────────────────────────────────────────────────────────────────────
observability:
  enabled: true
  logs:
    structured: true
    level: "info"
    include_step_ids: true
  metrics:
    enabled: true
    emit_cost: true
    emit_latency: true
    emit_gate_outcomes: true
    custom_metrics:
      - "citation_accuracy"
      - "precedent_relevance"
      - "format_compliance"
  traces:
    enabled: true
    correlation_id_required: true
  alerts:
    enabled: true
    alert_on:
      - "policy_violation"
      - "gate_fail_spike"
      - "deadline_risk"
      - "privilege_violation"
      - "cost_budget_exceeded"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: ethics.* (Boundaries)
# ─────────────────────────────────────────────────────────────────────────────────
ethics:
  enabled: true
  boundaries:
    no_illegal_guidance: true
    no_harmful_instructions: true
    no_deceptive_impersonation: true
    no_unauthorized_practice: true
  transparency:
    disclose_limits: true
    require_confidence_levels: true
  legal_ethics:
    privilege_protection: true
    conflict_check: true
    deadline_awareness: true
    ethics_rule_compliance: true

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: knowledge.* (Context7 Sources)
# ─────────────────────────────────────────────────────────────────────────────────
knowledge:
  primary_corpus:
    - "Federal Rules of Criminal Procedure"
    - "Federal Rules of Civil Procedure"
    - "Federal Rules of Evidence"
    - "US Bankruptcy Code (Title 11)"
    - "3rd Circuit Case Law (2015-present)"
    - "EDPA Local Rules"
  case_specific:
    - "Active case docket"
    - "Case documents in Supabase"
    - "Prior motion history"
  secondary_sources:
    - "Moore's Federal Practice"
    - "Wright & Miller"
    - "Collier on Bankruptcy"
  retrieval_config:
    vector_dimensions: 1536
    chunk_size: 512
    overlap: 50
    index_type: "HNSW"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: business.* (Metrics and Estimates)
# ─────────────────────────────────────────────────────────────────────────────────
business:
  cost_tracking:
    per_query: true
    per_document: true
    budget_alerts: true
  time_estimates:
    simple_motion: "30 minutes"
    complex_brief: "2 hours"
    research_memo: "1 hour"
    citation_check: "15 minutes"
    full_opposition: "3 hours"
  quality_targets:
    citation_accuracy: ">99%"
    precedent_relevance: ">95%"
    format_compliance: "100%"
    motion_quality: "ready_for_filing"

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: activation.* (Invocation)
# ─────────────────────────────────────────────────────────────────────────────────
activation:
  keyboard_shortcut: "Cmd+Shift+A"
  voice_command: "Attorney Bot"
  auto_start: false
  confirmation_required: true
  default_mode: false
  startup_message: |
    Attorney Bot activated. Awaiting your legal research or drafting task.
    Available actions: Research, Draft Motion, Check Citations, Build Argument
    What would you like me to help with?

# ─────────────────────────────────────────────────────────────────────────────────
# CLUSTER: safety.* (Guardrails)
# ─────────────────────────────────────────────────────────────────────────────────
safety:
  guardrails:
    privilege_protection: true
    ethics_compliance: true
    deadline_awareness: true
    conflict_check: true
  validation:
    all_citations_verified: true
    no_hallucinated_cases: true
    proper_bluebook_format: true
    jurisdiction_appropriate: true
  alerts:
    - "Approaching filing deadline"
    - "Conflicting precedent found"
    - "Ethics rule implicated"
    - "Privilege risk detected"
    - "Citation validity expired"
