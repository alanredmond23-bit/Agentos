# ═══════════════════════════════════════════════════════════════════════════════
# GOLDEN TASK: iOS Feature Implementation
# Tests: mobile_ios_swift agent capability
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  id: "mobile-golden-001"
  name: "iOS Feature Implementation - Biometric Login"
  pack: "mobile"
  agent: "mobile_ios_swift"
  version: "1.0.0"
  difficulty: "medium"
  estimated_time: "30min"

task:
  description: |
    Implement a biometric login feature for an iOS app using Face ID/Touch ID
    with secure keychain storage and PIN fallback.

  input:
    feature_name: "BiometricLogin"
    requirements:
      - "Support Face ID on compatible devices"
      - "Support Touch ID on older devices"
      - "Store credentials securely in Keychain"
      - "Provide PIN fallback for failed biometric"
      - "Handle biometric not enrolled scenario"
      - "Follow MVVM architecture"
    target_ios: "16.0+"
    architecture: "MVVM"
    dependencies:
      - "LocalAuthentication"
      - "Security"

  context:
    existing_code: |
      // App uses SwiftUI with MVVM
      // Existing AuthService protocol to implement
      protocol AuthServiceProtocol {
          func login(email: String, password: String) async throws -> User
          func logout() async throws
      }

expected_output:
  files:
    - path: "BiometricLoginView.swift"
      must_contain:
        - "LocalAuthentication"
        - "LAContext"
        - "evaluatePolicy"
        - "@StateObject"
      must_not_contain:
        - "force unwrap"
        - "try!"

    - path: "BiometricLoginViewModel.swift"
      must_contain:
        - "ObservableObject"
        - "@Published"
        - "async"
        - "error handling"

    - path: "KeychainManager.swift"
      must_contain:
        - "SecItemAdd"
        - "SecItemCopyMatching"
        - "kSecAttrAccessible"

    - path: "BiometricLoginTests.swift"
      must_contain:
        - "XCTestCase"
        - "func test"

  quality_checks:
    - name: "swiftlint_passes"
      threshold: 1.0

    - name: "no_force_unwraps"
      threshold: 1.0

    - name: "error_handling_present"
      threshold: 1.0

    - name: "accessibility_labels"
      threshold: 0.8

  behavior_checks:
    - scenario: "Face ID available and enrolled"
      expected: "Shows Face ID prompt, stores token on success"

    - scenario: "Face ID fails 3 times"
      expected: "Falls back to PIN entry"

    - scenario: "Biometric not enrolled"
      expected: "Shows setup prompt or PIN only"

evaluation:
  scoring:
    code_quality: 0.30
    functionality: 0.30
    security: 0.20
    testing: 0.20

  pass_threshold: 0.80

  rubric:
    excellent:
      score: 0.95
      criteria:
        - "All files generated correctly"
        - "Comprehensive error handling"
        - "Full test coverage"
        - "Accessibility implemented"

    good:
      score: 0.80
      criteria:
        - "Core functionality works"
        - "Basic error handling"
        - "Some tests present"

    needs_improvement:
      score: 0.60
      criteria:
        - "Partial implementation"
        - "Missing error handling"
        - "No tests"

tags:
  - "ios"
  - "swift"
  - "biometric"
  - "security"
  - "authentication"
